<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shrishti.ai - Patient Details</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-100 font-['Poppins'] flex justify-center items-start min-h-screen p-4 sm:p-8 text-slate-800">

  <!-- Added `relative` class for spinner positioning -->
  <div
    class="relative w-full max-w-2xl bg-white rounded-3xl shadow-lg p-6 sm:p-8 transition-all duration-300 hover:shadow-xl">

    <!-- ===== SPINNER OVERLAY (NEW) ===== -->
    <div id="loadingOverlay"
      class="hidden absolute inset-0 z-50 bg-white/80 backdrop-blur-sm rounded-3xl flex-col justify-center items-center">
      <div class="w-16 h-16 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"></div>
      <p class="mt-4 text-lg font-medium text-slate-700">Submitting your details...</p>
    </div>
    <!-- ===== END SPINNER OVERLAY ===== -->


    <!-- IMPORTANT: Added enctype for file uploads -->
    <form id="multiForm" method="post" action="" enctype="multipart/form-data">
      <!-- Top bar -->
      <div class="flex items-center gap-3 mb-3">
        <button id="backBtn" type="button" aria-label="Back"
          class="bg-slate-100 text-2xl leading-none text-slate-500 cursor-pointer p-2.5 rounded-xl transition-colors duration-200 hover:enabled:bg-slate-200 hover:enabled:text-slate-800 disabled:opacity-40 disabled:cursor-default">&#8592;</button>
        <span class="text-slate-500 font-medium text-sm" id="titlePath"></span>
      </div>
      <div class="w-full bg-slate-200 rounded-full h-2 mb-6">
        <div id="progressBar" class="bg-indigo-600 h-2 rounded-full transition-all duration-300" style="width: 25%">
        </div>
      </div>

      <!-- ===== Step 1: Basic Profile (Unchanged) ===== -->
      <div class="step" id="step1">
        <h2 class="mt-2 mb-6 text-center text-3xl font-bold text-slate-800 tracking-tight">Basic Profile</h2>
        <div class="space-y-4">
          <div><label for="fullName" class="block text-sm font-medium text-slate-700 mb-2">Full Name</label><input
              type="text" id="fullName" name="fullName" value="{{request.user}}" readonly
              class="w-full border border-slate-300 bg-slate-200 text-slate-500 px-4 py-3 rounded-xl cursor-not-allowed">
          </div>
          <div><label for="dob" class="block text-sm font-medium text-slate-700 mb-2">Date of Birth</label><input
              type="date" id="dob" name="dob" required
              class="w-full border border-slate-300 bg-slate-50 px-4 py-3 rounded-xl text-base outline-none text-slate-800 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20">
          </div>
          <div class="grid sm:grid-cols-2 gap-4">
            <div><label for="phone" class="block text-sm font-medium text-slate-700 mb-2">Phone Number</label><input
                type="tel" id="phone" name="phone" placeholder="e.g., 9876543210" required
                class="w-full border border-slate-300 bg-slate-50 px-4 py-3 rounded-xl text-base outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20">
            </div>
            <div><label for="language" class="block text-sm font-medium text-slate-700 mb-2">Preferred
                Language</label><select id="language" name="language"
                class="w-full border border-slate-300 bg-slate-50 px-4 py-3 rounded-xl text-base outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20">
                <option>English</option>
                <option>Hindi</option>
                <option>Hinglish</option>
              </select></div>
          </div>
          <div class="grid sm:grid-cols-2 gap-4">
            <div><label for="city" class="block text-sm font-medium text-slate-700 mb-2">City</label><input type="text"
                id="city" name="city" placeholder="e.g., Mumbai" required
                class="w-full border border-slate-300 bg-slate-50 px-4 py-3 rounded-xl text-base outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20">
            </div>
            <div><label for="pincode" class="block text-sm font-medium text-slate-700 mb-2">Pincode</label><input
                type="text" id="pincode" name="pincode" placeholder="e.g., 400001" required
                class="w-full border border-slate-300 bg-slate-50 px-4 py-3 rounded-xl text-base outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20">
            </div>
          </div>
        </div>
        <button type="button"
          class="w-full py-3.5 mt-6 border-none rounded-2xl cursor-pointer text-lg font-semibold text-white bg-indigo-600 hover:bg-indigo-700"
          onclick="go(2)">Next</button>
      </div>

      <!-- ===== Step 2: Pregnancy Details (Unchanged) ===== -->
      <div class="step" id="step2" style="display:none;">
        <h2 class="mt-2 mb-6 text-center text-3xl font-bold text-slate-800 tracking-tight">Pregnancy Details</h2>
        <div class="space-y-4">
          <div><label for="lmp" class="block text-sm font-medium text-slate-700 mb-2">Last Menstrual Period
              (LMP)</label><input type="date" id="lmp" name="lmp" required
              class="w-full border border-slate-300 bg-slate-50 px-4 py-3 rounded-xl text-base outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20">
          </div>
          <div><label for="dueDate" class="block text-sm font-medium text-slate-700 mb-2">Due Date (if
              known)</label><input type="date" id="dueDate" name="dueDate"
              class="w-full border border-slate-300 bg-slate-50 px-4 py-3 rounded-xl text-base outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20">
          </div>
          <div><label class="block text-sm font-medium text-slate-700 mb-2">Is this a multiple pregnancy (twins,
              etc.)?</label><select name="multiplePregnancy"
              class="w-full border border-slate-300 bg-slate-50 px-4 py-3 rounded-xl text-base outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20">
              <option value="Singleton">No, Singleton</option>
              <option value="Multiple">Yes, Multiple</option>
            </select></div>
          <div class="grid sm:grid-cols-2 gap-4">
            <div><label for="doctorName" class="block text-sm font-medium text-slate-700 mb-2">Current Doctor's
                Name</label><input type="text" id="doctorName" name="doctorName" placeholder="e.g., Dr. Priya Sharma"
                class="w-full border border-slate-300 bg-slate-50 px-4 py-3 rounded-xl text-base outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20">
            </div>
            <div><label for="hospitalName" class="block text-sm font-medium text-slate-700 mb-2">Hospital / Clinic
                Name</label><input type="text" id="hospitalName" name="hospitalName" placeholder="e.g., City Hospital"
                class="w-full border border-slate-300 bg-slate-50 px-4 py-3 rounded-xl text-base outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20">
            </div>
          </div>
          <div class="grid sm:grid-cols-2 gap-4">
            <div><label for="emergencyContactName" class="block text-sm font-medium text-slate-700 mb-2">Emergency
                Contact Name</label><input type="text" id="emergencyContactName" name="emergencyContactName" required
                class="w-full border border-slate-300 bg-slate-50 px-4 py-3 rounded-xl text-base outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20">
            </div>
            <div><label for="emergencyContactPhone" class="block text-sm font-medium text-slate-700 mb-2">Emergency
                Contact Phone</label><input type="tel" id="emergencyContactPhone" name="emergencyContactPhone" required
                class="w-full border border-slate-300 bg-slate-50 px-4 py-3 rounded-xl text-base outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20">
            </div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4 mt-6"><button type="button"
            class="w-full py-3.5 rounded-2xl bg-slate-200 text-slate-800 hover:bg-slate-300"
            onclick="go(1)">Back</button><button type="button"
            class="w-full py-3.5 rounded-2xl text-white bg-indigo-600 hover:bg-indigo-700" onclick="go(3)">Next</button>
        </div>
      </div>

      <!-- ===== Step 3: Medical History (Unchanged) ===== -->
      <div class="step" id="step3" style="display:none;">
        <h2 class="mt-2 mb-6 text-center text-3xl font-bold text-slate-800 tracking-tight">Medical History</h2>
        <div class="space-y-4">
          <div><label class="block text-sm font-medium text-slate-700 mb-2">Previous Pregnancies (GPAL)</label>
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-3"><input type="number" name="gpal_g"
                placeholder="Gravida (G)"
                class="w-full border border-slate-300 bg-slate-50 p-2 rounded-lg text-sm outline-none focus:border-indigo-500"><input
                type="number" name="gpal_p" placeholder="Para (P)"
                class="w-full border border-slate-300 bg-slate-50 p-2 rounded-lg text-sm outline-none focus:border-indigo-500"><input
                type="number" name="gpal_a" placeholder="Abortions (A)"
                class="w-full border border-slate-300 bg-slate-50 p-2 rounded-lg text-sm outline-none focus:border-indigo-500"><input
                type="number" name="gpal_l" placeholder="Living (L)"
                class="w-full border border-slate-300 bg-slate-50 p-2 rounded-lg text-sm outline-none focus:border-indigo-500">
            </div>
          </div>
          <div class="flex items-center justify-between py-2"><span class="text-slate-700">Previous
              C-section?</span><label class="relative inline-flex items-center cursor-pointer"><input type="checkbox"
                name="previousCSection" class="sr-only peer">
              <div
                class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600">
              </div>
            </label></div>
          <hr />
          <label class="block text-sm font-medium text-slate-700">Chronic Conditions</label>
          <div class="grid grid-cols-2 gap-x-6">
            <div class="flex items-center justify-between my-1"><span class="text-slate-700">Diabetes / GDM</span><label
                class="relative inline-flex items-center cursor-pointer"><input type="checkbox"
                  name="condition_diabetes" class="sr-only peer">
                <div
                  class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600">
                </div>
              </label></div>
            <div class="flex items-center justify-between my-1"><span class="text-slate-700">Hypertension</span><label
                class="relative inline-flex items-center cursor-pointer"><input type="checkbox"
                  name="condition_hypertension" class="sr-only peer">
                <div
                  class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600">
                </div>
              </label></div>
            <div class="flex items-center justify-between my-1"><span class="text-slate-700">Thyroid Issues</span><label
                class="relative inline-flex items-center cursor-pointer"><input type="checkbox" name="condition_thyroid"
                  class="sr-only peer">
                <div
                  class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600">
                </div>
              </label></div>
            <div class="flex items-center justify-between my-1"><span class="text-slate-700">PCOS</span><label
                class="relative inline-flex items-center cursor-pointer"><input type="checkbox" name="condition_pcos"
                  class="sr-only peer">
                <div
                  class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600">
                </div>
              </label></div>
            <div class="flex items-center justify-between my-1"><span class="text-slate-700">Anemia</span><label
                class="relative inline-flex items-center cursor-pointer"><input type="checkbox" name="condition_anemia"
                  class="sr-only peer">
                <div
                  class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600">
                </div>
              </label></div>
          </div>
          <hr />
          <label class="block text-sm font-medium text-slate-700">Allergies</label>
          <input type="text" name="drugAllergies" placeholder="Any drug allergies? (e.g., Penicillin, Sulfa)"
            class="w-full border border-slate-300 bg-slate-50 px-4 py-3 rounded-xl text-base outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20">
          <input type="text" name="foodAllergies" placeholder="Any food allergies?"
            class="w-full border border-slate-300 bg-slate-50 px-4 py-3 rounded-xl text-base outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20">
        </div>
        <div class="grid grid-cols-2 gap-4 mt-6"><button type="button"
            class="w-full py-3.5 rounded-2xl bg-slate-200 text-slate-800 hover:bg-slate-300"
            onclick="go(2)">Back</button><button type="button"
            class="w-full py-3.5 rounded-2xl text-white bg-indigo-600 hover:bg-indigo-700" onclick="go(4)">Next</button>
        </div>
      </div>

      <!-- ===== Step 4: Lifestyle, Vitals & Reports (Unchanged) ===== -->
      <div class="step" id="step4" style="display:none;">
        <h2 class="mt-2 mb-6 text-center text-3xl font-bold text-slate-800 tracking-tight">Lifestyle, Vitals & Reports
        </h2>
        <div class="space-y-4">
          <div class="grid sm:grid-cols-2 gap-4">
            <div><label for="diet" class="block text-sm font-medium text-slate-700 mb-2">Diet Type</label><select
                id="diet" name="diet"
                class="w-full border border-slate-300 bg-slate-50 px-4 py-3 rounded-xl outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20">
                <option>Vegetarian</option>
                <option>Non-veg</option>
                <option>Vegan</option>
                <option>Mixed</option>
              </select></div>
            <div><label for="activityLevel" class="block text-sm font-medium text-slate-700 mb-2">Physical Activity
                Level</label><select id="activityLevel" name="activityLevel"
                class="w-full border border-slate-300 bg-slate-50 px-4 py-3 rounded-xl outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20">
                <option>Sedentary</option>
                <option>Light</option>
                <option>Moderate</option>
                <option>Active</option>
              </select></div>
          </div>
          <div class="grid sm:grid-cols-2 gap-4">
            <div><label for="sleepHours" class="block text-sm font-medium text-slate-700 mb-2">Average Sleep
                Hours</label><input type="number" id="sleepHours" name="sleepHours" placeholder="e.g., 7"
                class="w-full border border-slate-300 bg-slate-50 px-4 py-3 rounded-xl outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20">
            </div>
            <div><label for="stressLevel" class="block text-sm font-medium text-slate-700 mb-2">Stress
                Level</label><select id="stressLevel" name="stressLevel"
                class="w-full border border-slate-300 bg-slate-50 px-4 py-3 rounded-xl outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20">
                <option>Low</option>
                <option>Moderate</option>
                <option>High</option>
              </select></div>
          </div>
          <hr />
          <div class="grid sm:grid-cols-2 gap-4">
            <div><label for="prePregnancyWeight" class="block text-sm font-medium text-slate-700 mb-2">Pre-pregnancy
                Weight (kg)</label><input type="number" step="0.1" id="prePregnancyWeight" name="prePregnancyWeight"
                placeholder="e.g., 60.5"
                class="w-full border border-slate-300 bg-slate-50 px-4 py-3 rounded-xl outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20">
            </div>
            <div><label for="currentWeight" class="block text-sm font-medium text-slate-700 mb-2">Current Weight
                (kg)</label><input type="number" step="0.1" id="currentWeight" name="currentWeight"
                placeholder="e.g., 65" required
                class="w-full border border-slate-300 bg-slate-50 px-4 py-3 rounded-xl outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20">
            </div>
          </div>
          <div><label for="height" class="block text-sm font-medium text-slate-700 mb-2">Height (cm)</label><input
              type="number" id="height" name="height" placeholder="e.g., 162" required
              class="w-full border border-slate-300 bg-slate-50 px-4 py-3 rounded-xl outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20">
          </div>
          <hr />
          <!-- FILE UPLOAD SECTION RESTORED -->
          <label class="block text-sm font-medium text-slate-700">Lab Reports (Optional, PDF only)</label>
          <div class="flex flex-wrap gap-3 mt-2">
            <label
              class="relative inline-flex items-center gap-2.5 rounded-xl border border-slate-300 bg-slate-50 px-4 py-3 text-sm font-medium text-slate-800 transition-colors duration-200 hover:border-indigo-500 hover:bg-slate-200 cursor-pointer">
              <span class="upload-icon font-bold text-indigo-600 text-lg">↑</span> Sonography Report
              <input type="file" name="sonographyReport" accept=".pdf"
                class="absolute inset-0 h-full w-full cursor-pointer opacity-0">
            </label>
            <label
              class="relative inline-flex items-center gap-2.5 rounded-xl border border-slate-300 bg-slate-50 px-4 py-3 text-sm font-medium text-slate-800 transition-colors duration-200 hover:border-indigo-500 hover:bg-slate-200 cursor-pointer">
              <span class="upload-icon font-bold text-indigo-600 text-lg">↑</span> Blood Report
              <input type="file" name="bloodReport" accept=".pdf"
                class="absolute inset-0 h-full w-full cursor-pointer opacity-0">
            </label>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4 mt-6"><button type="button"
            class="w-full py-3.5 rounded-2xl bg-slate-200 text-slate-800 hover:bg-slate-300"
            onclick="go(3)">Back</button><button type="submit"
            class="w-full py-3.5 rounded-2xl text-white bg-indigo-600 hover:bg-indigo-700">Submit</button></div>
      </div>
    </form>
  </div>

  <script>
    // ===== Language Dictionary =====
    const translations = {
      English: {
        steps: ["Basic Profile", "Pregnancy Details", "Medical History", "Lifestyle, Vitals & Reports"],
  
        // Step 1
        fullName: "Full Name",
        dob: "Date of Birth",
        phone: "Phone Number",
        language: "Preferred Language",
        city: "City",
        pincode: "Pincode",
  
        // Step 2
        lmp: "Last Menstrual Period (LMP)",
        dueDate: "Due Date (if known)",
        multiplePregnancy: "Is this a multiple pregnancy (twins, etc.)?",
        doctorName: "Current Doctor's Name",
        hospitalName: "Hospital / Clinic Name",
        emergencyContactName: "Emergency Contact Name",
        emergencyContactPhone: "Emergency Contact Phone",
  
        // Step 3
        prevPreg: "Previous Pregnancies (GPAL)",
        csection: "Previous C-section?",
        conditions: "Chronic Conditions",
        diabetes: "Diabetes / GDM",
        hypertension: "Hypertension",
        thyroid: "Thyroid Issues",
        pcos: "PCOS",
        anemia: "Anemia",
        allergies: "Allergies",
        drugAllergies: "Any drug allergies? (e.g., Penicillin, Sulfa)",
        foodAllergies: "Any food allergies?",
  
        // Step 4
        lifestyle: "Lifestyle, Vitals & Reports",
        diet: "Diet Type",
        activityLevel: "Physical Activity Level",
        sleep: "Average Sleep Hours",
        stress: "Stress Level",
        preWeight: "Pre-pregnancy Weight (kg)",
        currWeight: "Current Weight (kg)",
        height: "Height (cm)",
        reports: "Lab Reports (Optional, PDF only)",
        sonography: "Sonography Report",
        blood: "Blood Report",
  
        // Buttons
        next: "Next",
        back: "Back",
        submit: "Submit",
      },
  
      Hindi: {
        steps: ["मूल प्रोफ़ाइल", "गर्भावस्था विवरण", "चिकित्सा इतिहास", "जीवनशैली, महत्वपूर्ण और रिपोर्ट"],
  
        // Step 1
        fullName: "पूरा नाम",
        dob: "जन्म तिथि",
        phone: "फ़ोन नंबर",
        language: "पसंदीदा भाषा",
        city: "शहर",
        pincode: "पिनकोड",
  
        // Step 2
        lmp: "अंतिम माहवारी (LMP)",
        dueDate: "अनुमानित प्रसव तिथि (यदि ज्ञात हो)",
        multiplePregnancy: "क्या यह बहु गर्भावस्था (जुड़वां आदि) है?",
        doctorName: "वर्तमान डॉक्टर का नाम",
        hospitalName: "अस्पताल / क्लिनिक का नाम",
        emergencyContactName: "आपातकालीन संपर्क नाम",
        emergencyContactPhone: "आपातकालीन संपर्क फ़ोन",
  
        // Step 3
        prevPreg: "पिछली गर्भावस्थाएँ (GPAL)",
        csection: "पिछला सी-सेक्शन?",
        conditions: "दीर्घकालिक स्थितियाँ",
        diabetes: "डायबिटीज / GDM",
        hypertension: "हाई ब्लड प्रेशर",
        thyroid: "थायरॉयड समस्या",
        pcos: "पीसीओएस",
        anemia: "एनीमिया",
        allergies: "एलर्जी",
        drugAllergies: "कोई दवा एलर्जी? (जैसे पेनिसिलिन, सल्फा)",
        foodAllergies: "कोई खाद्य एलर्जी?",
  
        // Step 4
        lifestyle: "जीवनशैली, महत्वपूर्ण और रिपोर्ट",
        diet: "आहार प्रकार",
        activityLevel: "शारीरिक गतिविधि स्तर",
        sleep: "औसत नींद घंटे",
        stress: "तनाव स्तर",
        preWeight: "गर्भावस्था से पहले वजन (किग्रा)",
        currWeight: "वर्तमान वजन (किग्रा)",
        height: "ऊँचाई (सेमी)",
        reports: "लैब रिपोर्ट (वैकल्पिक, केवल PDF)",
        sonography: "सोनोग्राफी रिपोर्ट",
        blood: "ब्लड रिपोर्ट",
  
        // Buttons
        next: "आगे",
        back: "पीछे",
        submit: "जमा करें",
      },
  
      Hinglish: {
        steps: ["Basic Profile", "Pregnancy Details", "Medical History", "Lifestyle, Vitals & Reports"],
  
        // Step 1
        fullName: "Full Naam",
        dob: "Janm Tithi",
        phone: "Phone Number",
        language: "Pasandida Language",
        city: "Sheher",
        pincode: "Pincode",
  
        // Step 2
        lmp: "Last Mahavari (LMP)",
        dueDate: "Due Date (agar pata ho)",
        multiplePregnancy: "Kya yeh multiple pregnancy hai (twins, etc.)?",
        doctorName: "Current Doctor ka Naam",
        hospitalName: "Hospital / Clinic Naam",
        emergencyContactName: "Emergency Contact Naam",
        emergencyContactPhone: "Emergency Contact Phone",
  
        // Step 3
        prevPreg: "Previous Pregnancies (GPAL)",
        csection: "Pehle C-section?",
        conditions: "Chronic Conditions",
        diabetes: "Diabetes / GDM",
        hypertension: "High BP",
        thyroid: "Thyroid Issues",
        pcos: "PCOS",
        anemia: "Anemia",
        allergies: "Allergies",
        drugAllergies: "Koi drug allergies? (e.g., Penicillin, Sulfa)",
        foodAllergies: "Koi food allergies?",
  
        // Step 4
        lifestyle: "Lifestyle, Vitals & Reports",
        diet: "Diet Type",
        activityLevel: "Physical Activity Level",
        sleep: "Average Neend Hours",
        stress: "Stress Level",
        preWeight: "Pregnancy se pehle Wazan (kg)",
        currWeight: "Abhi ka Wazan (kg)",
        height: "Height (cm)",
        reports: "Lab Reports (Optional, PDF only)",
        sonography: "Sonography Report",
        blood: "Blood Report",
  
        // Buttons
        next: "Aage",
        back: "Peeche",
        submit: "Submit Karo",
      }
    };
  
    // ===== Update Form Language =====
    function updateLanguage(lang) {
      const t = translations[lang];
  
      // Step titles
      titles.splice(0, titles.length, ...t.steps);
      show(current);
  
      // Step 1
      document.querySelector("label[for='fullName']").textContent = t.fullName;
      document.querySelector("label[for='dob']").textContent = t.dob;
      document.querySelector("label[for='phone']").textContent = t.phone;
      document.querySelector("label[for='language']").textContent = t.language;
      document.querySelector("label[for='city']").textContent = t.city;
      document.querySelector("label[for='pincode']").textContent = t.pincode;
  
      // Step 2
      document.querySelector("label[for='lmp']").textContent = t.lmp;
      document.querySelector("label[for='dueDate']").textContent = t.dueDate;
      document.querySelector("#step2 select[name='multiplePregnancy']").previousElementSibling.textContent = t.multiplePregnancy;
      document.querySelector("label[for='doctorName']").textContent = t.doctorName;
      document.querySelector("label[for='hospitalName']").textContent = t.hospitalName;
      document.querySelector("label[for='emergencyContactName']").textContent = t.emergencyContactName;
      document.querySelector("label[for='emergencyContactPhone']").textContent = t.emergencyContactPhone;
  
      // Step 3
      document.querySelector("#step3 label.block").textContent = t.prevPreg;
      document.querySelector("#step3 .flex span").textContent = t.csection;
      document.querySelector("#step3 hr + label").textContent = t.conditions;
      document.querySelectorAll("#step3 .flex span")[1].textContent = t.diabetes;
      document.querySelectorAll("#step3 .flex span")[2].textContent = t.hypertension;
      document.querySelectorAll("#step3 .flex span")[3].textContent = t.thyroid;
      document.querySelectorAll("#step3 .flex span")[4].textContent = t.pcos;
      document.querySelectorAll("#step3 .flex span")[5].textContent = t.anemia;
      document.querySelectorAll("#step3 label.block")[2].textContent = t.allergies;
      document.querySelector("input[name='drugAllergies']").placeholder = t.drugAllergies;
      document.querySelector("input[name='foodAllergies']").placeholder = t.foodAllergies;
  
      // Step 4
      document.querySelector("#step4 h2").textContent = t.lifestyle;
      document.querySelector("label[for='diet']").textContent = t.diet;
      document.querySelector("label[for='activityLevel']").textContent = t.activityLevel;
      document.querySelector("label[for='sleepHours']").textContent = t.sleep;
      document.querySelector("label[for='stressLevel']").textContent = t.stress;
      document.querySelector("label[for='prePregnancyWeight']").textContent = t.preWeight;
      document.querySelector("label[for='currentWeight']").textContent = t.currWeight;
      document.querySelector("label[for='height']").textContent = t.height;
      document.querySelector("#step4 label.block.text-sm").textContent = t.reports;
      document.querySelectorAll("#step4 label span.upload-icon + text, #step4 label").forEach((lbl, idx) => {
        if (idx === 0) lbl.innerHTML = `<span class="upload-icon font-bold text-indigo-600 text-lg">↑</span> ${t.sonography}`;
        if (idx === 1) lbl.innerHTML = `<span class="upload-icon font-bold text-indigo-600 text-lg">↑</span> ${t.blood}`;
      });
  
      // Buttons (all steps)
      document.querySelectorAll("button").forEach(btn => {
        if (btn.textContent.includes("Next") || btn.textContent.includes("आगे") || btn.textContent.includes("Aage"))
          btn.textContent = t.next;
        if (btn.textContent.includes("Back") || btn.textContent.includes("पीछे") || btn.textContent.includes("Peeche"))
          btn.textContent = t.back;
        if (btn.textContent.includes("Submit") || btn.textContent.includes("जमा") || btn.textContent.includes("Karo"))
          btn.textContent = t.submit;
      });
    }
  
    // Event listener
    document.getElementById("language").addEventListener("change", (e) => {
      updateLanguage(e.target.value);
    });
  </script>  

  <script>
    let current = 1; const totalSteps = 4; const form = document.getElementById("multiForm"); const backBtn = document.getElementById("backBtn"); const titlePath = document.getElementById("titlePath"); const progressBar = document.getElementById("progressBar"); const titles = ["Basic Profile", "Pregnancy Details", "Medical History", "Lifestyle, Vitals & Reports"];
    // ===== MODIFIED SCRIPT =====
    const loadingOverlay = document.getElementById("loadingOverlay");

    function validateStep(stepNumber) { const currentStepDiv = document.getElementById("step" + stepNumber); const inputs = currentStepDiv.querySelectorAll('input[required], select[required]'); for (const input of inputs) { if (!input.checkValidity()) { input.reportValidity(); return false; } } return true; }
    function show(stepNumber) { for (let i = 1; i <= totalSteps; i++) { document.getElementById("step" + i).style.display = (i === stepNumber) ? "block" : "none"; } backBtn.disabled = stepNumber === 1; titlePath.textContent = `${titles[stepNumber - 1]} (${stepNumber} of ${totalSteps})`; progressBar.style.width = `${(stepNumber / totalSteps) * 100}%`; current = stepNumber; window.scrollTo(0, 0); }
    function go(stepNumber) { if (stepNumber > current && !validateStep(current)) { return; } show(stepNumber); }
    backBtn.addEventListener("click", () => { if (current > 1) go(current - 1); });

    // Modified submit handler to show spinner
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      if (!validateStep(current)) {
        return;
      }
      // Show the loading spinner overlay
      if (loadingOverlay) {
        loadingOverlay.classList.remove('hidden');
        loadingOverlay.classList.add('flex');
      }
      // Disable the submit button to prevent multiple submissions
      const submitButton = form.querySelector('button[type="submit"]');
      if (submitButton) {
        submitButton.disabled = true;
      }

      // Use a short timeout to allow the UI to update and show the spinner
      // before the form submission potentially blocks the main thread.
      setTimeout(() => {
        form.submit();
      }, 100);
    });

    show(1);
    // File input highlight logic (Unchanged)
    document.querySelectorAll('input[type="file"]').forEach(input => {
      input.addEventListener('change', event => {
        const label = event.target.parentElement;
        const icon = label.querySelector('.upload-icon');
        if (event.target.files && event.target.files.length > 0) {
          label.classList.add('bg-green-50', 'border-green-500', 'text-green-800');
          if (icon) icon.innerHTML = '&#10003;';
        }
      });
    });
  </script>
</body>

</html>